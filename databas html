<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aktivitetsdatabas</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            padding: 20px;
            color: #333;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
        }

        .toolbar {
            margin-bottom: 15px;
            text-align: right;
        }

        button {
            padding: 10px 15px;
            margin-left: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .btn-add {
            background-color: #27ae60;
            color: white;
        }

        .btn-save {
            background-color: #2980b9;
            color: white;
        }

        .btn-delete {
            background-color: #c0392b;
            color: white;
            padding: 5px 10px;
            font-size: 12px;
        }

        button:hover {
            opacity: 0.9;
        }

        .table-container {
            overflow-x: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            background-color: white;
            border-radius: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #2c3e50;
            color: white;
            position: sticky;
            top: 0;
        }

        /* Gör cellerna redigerbara visuellt */
        td[contenteditable="true"]:hover {
            background-color: #f1f1f1;
            cursor: text;
            outline: 1px solid #ccc;
        }

        td[contenteditable="true"]:focus {
            background-color: #fff;
            outline: 2px solid #2980b9;
        }

        tr:hover {
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>

    <h1>Hantera Aktiviteter</h1>

    <div class="toolbar">
        <button class="btn-add" onclick="addRow()">+ Lägg till rad</button>
        <button class="btn-save" onclick="saveFile()">Spara till CSV</button>
    </div>

    <div class="table-container">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>Kategori</th>
                    <th>Aktivitet</th>
                    <th>Parameter 1</th>
                    <th>Parameter 2</th>
                    <th>Parameter 3</th>
                    <th>Parameter 4</th>
                    <th>Parameter 5</th>
                    <th>Åtgärd</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                </tbody>
        </table>
    </div>

    <script>
        // Här ligger din startdata (baserat på filen du laddade upp)
        const initialData = [
            ["Exempelkategor 1", "Exempelaktivitet 1", "Fjsdkfjslg fdjgkf", "Kfshdfuh fhh fjdksl", "Ldjak dj", "Kafjhdfh", "Odjdn sgshj hdj"],
            ["Exempelkategor 1", "Exempelaktivitet 2", "Hjffd dsk rhsakj", "Jdfha gf gej", "Qjfl nfj dsj", "Efjks nfn dsjjj", "Ijfn dnha hfjj"],
            ["Exempelkategor 2", "Exempelaktivitet 3", "Uhfs bsdhsd", "Afjsk nfj djfk", "Öfjhd dhh hs", "Gsdd nsdf hsdj", "Pkdjfsfds"],
            ["Exempelkategor 3", "Exempelaktivitet 4", "fjsdkflk fjds", "sdfiu fs<df", "5434565", "sdfserdga", "Osadhas d"],
            ["Exempelkategor 3", "Exempelaktivitet 5", "uewsjdfgn", "sdfsaas", "dfsdf", "sdfss,dfsdha", "asfasf"],
            ["Exempelkategor 3", "Exempelaktivitet 6", "asfhsfkg", "hdfsfasd", "sdf", "dhjas dsfhs", "Wdsnfhj"]
        ];

        const tableBody = document.getElementById('tableBody');

        // Funktion för att bygga tabellen vid start
        function renderTable() {
            initialData.forEach(rowData => {
                createNewRow(rowData);
            });
        }

        // Funktion för att skapa en ny rad
        function createNewRow(data = ["", "", "", "", "", "", ""]) {
            const tr = document.createElement('tr');
            
            // Skapa celler för datan
            data.forEach(cellText => {
                const td = document.createElement('td');
                td.contentEditable = "true"; // Gör cellen redigerbar
                td.innerText = cellText;
                tr.appendChild(td);
            });

            // Skapa raderingsknapp
            const actionTd = document.createElement('td');
            const deleteBtn = document.createElement('button');
            deleteBtn.innerText = "Ta bort";
            deleteBtn.className = "btn-delete";
            deleteBtn.onclick = function() {
                tr.remove();
            };
            actionTd.appendChild(deleteBtn);
            tr.appendChild(actionTd);

            tableBody.appendChild(tr);
        }

        // Koppla "Lägg till rad"-knappen
        function addRow() {
            createNewRow();
            // Scrolla längst ner
            window.scrollTo(0, document.body.scrollHeight);
        }

        // Funktion för att spara datan till CSV
        function saveFile() {
            let csvContent = "Kategori,Aktivitet,Parameter 1,Parameter 2,Parameter 3,Parameter 4,Parameter 5\n";
            const rows = tableBody.querySelectorAll('tr');

            rows.forEach(row => {
                let rowData = [];
                const cells = row.querySelectorAll('td');
                
                // Loopa igenom alla celler utom den sista (som är raderingsknappen)
                for (let i = 0; i < cells.length - 1; i++) {
                    // Hantera citattecken och kommatecken i texten för att inte förstöra CSV-formatet
                    let text = cells[i].innerText.replace(/"/g, '""'); 
                    if (text.includes(',') || text.includes('\n')) {
                        text = `"${text}"`;
                    }
                    rowData.push(text);
                }
                csvContent += rowData.join(",") + "\n";
            });

            // Skapa en "Blob" (fil) och ladda ner den
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            const url = URL.createObjectURL(blob);
            
            // Sätt dagens datum i filnamnet
            const date = new Date().toISOString().slice(0,10);
            link.setAttribute("href", url);
            link.setAttribute("download", `databas_uppdaterad_${date}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Kör igång allt
        renderTable();
    </script>
</body>
</html>